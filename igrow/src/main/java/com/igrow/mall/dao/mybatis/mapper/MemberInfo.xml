<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.igrow.mall.dao.mybatis.intf.MemberDao">

	<!-- 以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->  
	<!--<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/>  -->
	<cache type="org.mybatis.caches.ehcache.EhcacheCache"/> 
	
	<!--返回map1-->
	<resultMap id="MemberRM" type="TmemberInfo">
		<id property="id" column="id" />
		<result property="memberSn" column="member_sn"/>
		<result property="openId" column="open_id"/>
		<result property="name" column="name"/>
		<result property="password" column="password"/>
		<result property="mobile" column="mobile"/>
		<result property="isAccountEnabled" column="is_account_enabled"
				typeHandler="EnumOrdinalTypeHandler" javaType="Ebool"/>
		<result property="isAccountLocked" column="is_account_locked"
				typeHandler="EnumOrdinalTypeHandler" javaType="Ebool"/>
		<result property="loginFailureCount" column="login_failure_count"/>	
		<result property="lockedDate" column="locked_date"/>	
		<result property="lastLoginIp" column="last_login_ip"/>	
		<result property="lastLoginDate" column="last_login_date"/>	
		<result property="lastToken" column="last_token"/>	
		<result property="isLogin" column="is_login"
				typeHandler="EnumOrdinalTypeHandler" javaType="Ebool"/>	
		<result property="openid" column="openid"/>
		<result property="deviceSn" column="device_sn"/>
		<result property="totalSpendAmount" column="total_spend_amount"/>
		<result property="createDate" column="create_date"/>
		<result property="modifyDate" column="modify_date"/>
		<result property="createOperator" column="create_operator"/>
		<result property="modifyOperator" column="modify_operator"/>	
	</resultMap>

	<!--1.查询  -->
	<select id="find" parameterType="int" resultMap="MemberRM" useCache="false">
         SELECT m.* FROM t_member_info m  where m.id = #{id}
	</select>
	
	<!--2.插入-->
	<insert id="insert" parameterType="TmemberInfo"  keyProperty="id" useGeneratedKeys="true" flushCache="false">
		<!-- <selectKey resultType="int" keyProperty="id" order="AFTER" >
         	SELECT LAST_INSERT_ID()
        </selectKey>  -->
		<![CDATA[
			insert into t_member_info 
				(name,account_id,member_sn,open_id,password,mobile,is_account_enabled,is_account_locked,
				login_failure_count,locked_date,last_login_ip,last_login_date,last_token,is_login,
				device_sn,openid,total_spend_amount,create_date,modify_date,create_operator,modify_operator)
					values
				(#{name},#{memberAccount.id},#{memberSn},#{openId},#{password},#{mobile},
				#{isAccountEnabled,javaType=Ebool,typeHandler=EnumOrdinalTypeHandler},
				#{isAccountLocked,javaType=Ebool,typeHandler=EnumOrdinalTypeHandler},
				#{loginFailureCount},#{lockedDate},#{lastLoginIp},#{lastLoginDate},#{lastToken},
				#{isLogin,javaType=Ebool,typeHandler=EnumOrdinalTypeHandler},
				#{deviceSn},#{openid},#{totalSpendAmount},#{createDate},#{modifyDate},#{createOperator},#{modifyOperator})
		]]>
	</insert>
	
	<!--3.修改-->
	<update id="update" parameterType="TmemberInfo" flushCache="false">
		<![CDATA[
			update t_member_info 
				  set
						name = #{name},
						account_id = #{memberAccount.id},
						openid = #{openid},
						password = #{password},
						mobile = #{mobile},
						is_account_enabled = #{isAccountEnabled,javaType=Ebool,typeHandler=EnumOrdinalTypeHandler},
						is_account_locked = #{isAccountLocked,javaType=Ebool,typeHandler=EnumOrdinalTypeHandler},
						login_failure_count = #{loginFailureCount},
						locked_date = #{lockedDate},
						last_login_ip = #{lastLoginIp},
						last_login_date = #{lastLoginDate},
						last_token = #{lastToken},
						is_login = #{isLogin,javaType=Ebool,typeHandler=EnumOrdinalTypeHandler},
						device_sn = #{deviceSn},
						total_spend_amount = #{totalSpendAmount},
						modify_date = #{modifyDate},
						modify_operator = #{modifyOperator}
					where id = #{id}
		]]>
	</update>
	
	<!--4.删除-->
	<delete id="delete" parameterType="TmemberInfo" flushCache="false">
		<![CDATA[
			delete from t_member_info
				   where id = #{id}
		]]>
	</delete>
	
	<!--5.查询总数量 -->
	<select id="getTotalCount" resultType="long" useCache="false">
		<![CDATA[
			SELECT count("id") FROM t_member_info
		]]>
	</select>
	
	<!--6.查询总记录集 -->
	<select id="findAllList" resultMap="MemberRM" useCache="false">
		<![CDATA[
			SELECT * FROM t_member_info
		]]>
	</select>
	
	<!--7.依据条件查询记录集 -->
	<select id="findListBy" parameterType="hashMap" resultMap="MemberRM" useCache="false">
			 SELECT m.* FROM t_member_info m  where 1=1 and m.mobile is not null
			 <if test="name != null">
			  	and m.mobile like "%"#{name}"%"
		     </if>
		     <if test="minAmount != null">
		        and <![CDATA[ m.total_spend_amount >= #{minAmount}  ]]>
		     </if>
		     <if test="maxAmount != null">
		        and <![CDATA[ m.total_spend_amount <= #{maxAmount}  ]]>
		     </if>
			 <if test="orderBy != null and order != null">
			 	ORDER BY m.${orderBy} ${order}
			 </if>
			 <if test="firstIndex != null and pageSize != null">
			 	LIMIT #{firstIndex} ,#{pageSize}
			 </if>
	</select>
	
	<!--8.依据条件查询数量 -->
	<select id="getCountBy" parameterType="hashMap" resultType="long" useCache="false">
			SELECT count(*) FROM t_member_info  where 1=1
	        <if test="name != null">
			  	  and m.mobile like "%"#{name}"%"
		     </if>
		     <if test="minAmount != null">
		        and <![CDATA[ m.total_spend_amount >= #{minAmount}  ]]>
		     </if>
		     <if test="maxAmount != null">
		        and <![CDATA[ m.total_spend_amount <= #{maxAmount}  ]]>
		     </if>
			 <if test="orderBy != null and order != null">
			 	ORDER BY m.${orderBy} ${order}
			 </if>
			 <if test="firstIndex != null and pageSize != null">
			 	LIMIT #{firstIndex} ,#{pageSize}
			 </if>
	</select>
	
	<!--9.依据MemberSn查询对象  -->
	<select id="findBySn" parameterType="String" resultMap="MemberRM" useCache="false">
		<![CDATA[
			SELECT * FROM t_member_info WHERE member_sn = #{memberSn}
				LIMIT 0 ,1
		]]>
	</select>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	
	<!--10.依据mobile查询对象  -->
	<select id="findByMobile" parameterType="String" resultMap="MemberRM" useCache="false">
		<![CDATA[
			SELECT * FROM t_member_info WHERE mobile = #{mobile}
				LIMIT 0 ,1
		]]>
	</select>
	
	<select id="findByOpenId" parameterType="String" resultMap="MemberRM" useCache="false">
		<![CDATA[
				SELECT * FROM t_member_info WHERE openid = #{openid}
					LIMIT 0 ,1
			]]>
	</select>
	
</mapper>
